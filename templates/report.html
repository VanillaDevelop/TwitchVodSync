{% extends "template.html" %}

{% block body %}
    <h3>Stream View</h3>
    {% if twitch_token %}
        <div id="streams">

        </div>
        <h5>Add a Twitch VOD</h5>
        <form onsubmit="submitVod(event)" id=twitchvod_form">
            <input type="text" name="twitch_vod" placeholder="Video ID"/>
            <button class="btn btn-primary">Add Twitch VOD</button>
        </form>
    {% else %}
        To add a stream view, you need to authorize with Twitch.
        Sign-in with Twitch
        <form action="/auth/twitch_challenge" method="POST">
            <input hidden type="text" name="code" value="{{code}}"/>
            <button class="btn btn-primary">Sign-in</button>
        </form>
    {% endif %}
    <div><h3>This report was created from {{ start_time }} to {{ end_time }}</h3></div>
    {% for fight in fights %}
        {% if fight["encounterID"] != 0 %}
        <div>
            Pull from {{fight["timestampStart"]}} to {{fight["timestampEnd"]}} ({{encounternames[fight["encounterID"]]}})
        </div>
        {% endif %}
    {% endfor %}
{% endblock %}

{% block scripts %}
    <script>
    videolist = {}
    videonames = {}

    function submitVod(event)
    {
        event.preventDefault();
        $.ajax({
            async: true,
            type: "GET",
            dataType: 'json',
            url: "/ajax/twitch/vod?id=0",
            contentType: "application/json; charset=utf-8",
            success: function (msg) {
                let d = new Date(msg['created_at'])
                videolist[msg['id']] = d.getTime()/1000
                videonames[msg['id']] = msg['title']
            }
         });
    }
    </script>
{% endblock %}